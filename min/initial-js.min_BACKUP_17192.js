<<<<<<< HEAD
var app=angular.module("app",["ngRoute"]);app.config(["$routeProvider","$sceProvider","$locationProvider","$controllerProvider","$provide","$compileProvider","$filterProvider","$sceDelegateProvider",function($routeProvider,$sceProvider,$locationProvider,$controllerProvider,$provide,$compileProvider,$filterProvider,$sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","https://script.google.com"]);var vp="src/views/";$routeProvider.when("/",{templateUrl:vp+"home.html"}).when("/tag/:category",{templateUrl:vp+"category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/search/:category",{templateUrl:vp+"category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/id/:id",{controller:"gameCtrl",controllerAs:"g",templateUrl:vp+"game.html"}).when("/submit",{templateUrl:vp+"submit.html"}).when("/cookies",{templateUrl:vp+"policy.html"}).when("/contact",{templateUrl:vp+"contact.html"}).when("/game/:id",{redirectTo:"/id/:id"}).when("/tag",{redirectTo:"/"}).when("/403",{templateUrl:vp+"error.html"}).when("/401",{templateUrl:vp+"error.html"}).otherwise({templateUrl:vp+"error.html"});$sceProvider.enabled(true);$locationProvider.html5Mode(true);app.controller=function(name,constructor){$controllerProvider.register(name,constructor);return this};app.service=function(name,constructor){$provide.service(name,constructor);return this};app.factory=function(name,factory){$provide.factory(name,factory);return this};app.value=function(name,value){$provide.value(name,value);return this};app.directive=function(name,factory){$compileProvider.directive(name,factory);return this};app.filter=function(name,constructor){$filterProvider.register(name,constructor);return this}}]);app.service("initialJSON",["$http","$lhttp","urls",function($http,$lhttp,urls){var vm=this;vm.pass=encodeURIComponent(window.location.search.slice(1)+window.location.hash.slice(1));vm.json=$lhttp.get(urls.initialJSON+"?pass="+vm.pass);vm.jquery=$lhttp.get("https://code.jquery.com/jquery-2.2.3.min.js",0);vm.jquery.then(function(data){eval(data)})}]);app.directive("script",function(){return{restrict:"E",scope:false,link:function(scope,elem,attr){if(attr.type==="text/javascript-lazy"){var code=elem[0].text;eval(code)}}}});app.value("urls",{rating:"https://script.google.com/macros/s/AKfycbzulzGAeSR2eErndxSAUkDi3dXlnmYif0MlkpjnfJsHKVNSMpE/exec",checkIfChanged:"https://script.google.com/macros/s/AKfycbwx-oLuzjUIAPxMxKiiNFgt6Wgb6T4WGO8UguTGu8HCXUBt-SX7/exec",comment:"https://script.google.com/macros/s/AKfycbwK2mif23UU5f9B2NXuvcRT6VajMU7iXQPxRnlKeNtfsD2Eflvz/exec",countGames:"https://script.google.com/macros/s/AKfycbwc3i7zLH3vC8HWnVtBVPqZkv8iOMIlxKZ1E7gL2bdIL8kd9lA/exec",getGames:"https://script.google.com/macros/s/AKfycbxGh5agyHkqBi5KbpYxl9G2gJlR5kuJzjJ--5BaP-KfcgaItx0/exec",submitGame:"https://script.google.com/macros/s/AKfycbxh_WPU_DKwT3xAxR0BCcjb_wQ4pQG2nspBbpKra94BEYlO4yw/exec",subscribe:"",initialJSON:"/min/initialJSON.json"});app.service("$lhttp",["$http","$q","$timeout",function($http,$q,$timeout){let vm=this;vm.ldbOn=true;try{!function(){function e(t,o){return n?void(n.transaction("s").objectStore("s").get(t).onsuccess=function(e){var t=e.target.result&&e.target.result.v||null;o(t)}):void setTimeout(function(){e(t,o)},100)}var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!t)return void console.error("indexDB not supported");var n,o={k:"",v:""},r=t.open("d2",1);r.onsuccess=function(e){n=this.result},r.onerror=function(e){console.error("indexedDB request error"),console.log(e)},r.onupgradeneeded=function(e){n=null;var t=e.target.result.createObjectStore("s",{keyPath:"k"});t.transaction.oncomplete=function(e){n=e.target.db}},window.ldb={get:e,set:function(e,t){o.k=e,o.v=t,n.transaction("s","readwrite").objectStore("s").put(o)}}}()}catch(e){console.warn("Unable to use lbd, using localStorage instead. Error:",e);vm.ldbOn=false}vm.get=((url,timeout,options,extra_promise)=>{let deferred=$q.defer();if(typeof options==="undefined")options={};options.timeout=deferred.promise;let request=$http.get(url,options);request.success(function(data){try{vm.ldbOn?ldb.set(url,JSON.stringify(data)):localStorage[url]=JSON.stringify(data)}catch(e){console.log("Couldn't save "+url+"-data to storage. Error:",e)}deferred.resolve(data)});request.error(function(data,status){try{ldb.get(url,data=>{if(data!==null){deferred.resolve(JSON.parse(data))}else{typeof localStorage[url]!=="undefined"?deferred.resolve(JSON.parse(localStorage[url])):deferred.reject("ERROR")}})}catch(e){try{typeof localStorage[url]!=="undefined"?deferred.resolve(JSON.parse(localStorage[url])):deferred.reject("ERROR")}catch(e){deferred.reject("ERROR")}}});if(typeof timeout!=="undefined"){$timeout(function(){if(vm.ldbOn){ldb.get(url,data=>{data!==null?deferred.resolve(JSON.parse(data)):""})}else if(typeof Storage!=="undefined"&&url in localStorage){deferred.resolve(JSON.parse(localStorage[url]))}},timeout)}if(typeof extra_promise!=="undefined"){extra_promise.catch(()=>{deferred.reject("Canceled")})}return deferred.promise})}]);app.controller("masterCtrl",["$http","$window","$rootScope","$routeParams","$scope","$location","$timeout","$injector","$q","initialJSON","$lhttp","urls",function($http,$window,$rootScope,$routeParams,$scope,$location,$timeout,$injector,$q,initialJSON,$lhttp,urls){var vm=this;vm.disabled=false;var block=false;vm.lang=window.navigator.language.replace(/-.+/g,"");vm.availableLangs=[];vm.desc="";vm.games=[];vm.categoryGames={};vm.routeChanged=false;vm.verifiedUser=false;vm.otag="";vm.tags=[{name:"Puzzle",amount:470},{name:"Action",amount:334},{name:"Jigsaw Puzzles",amount:315},{name:"Shooting",amount:256},{name:"HTML5",amount:210},{name:"Racing",amount:202},{name:"Adventure",amount:196}];vm.x=18;vm.textData={};vm.tagLimit=8;vm.showAllTags=false;vm.availableLangs=["en","es","no"];if(window.location.href.includes("lang=")){vm.lang=window.location.href.replace(/.+lang=/,"")}vm.lang=vm.lang=="nb"||vm.lang=="nn"?"no":vm.lang;vm.lang=vm.availableLangs.indexOf(vm.lang)>-1?vm.lang:"en";vm.allGamesAreDisplayed=function(){if(vm.games.length<vm.x)return false;return true};initialJSON.json.then(function(data){Array.prototype.push.apply(vm.games,data.initialGames);vm.verifiedUser=data.verifiedUser;vm.tags=data.topTags;vm.x=data.count});vm.requestGames=function(x){if(!block&&!vm.allGamesAreDisplayed()){block=true;var fr=vm.games.length;var url=urls.getGames+"?from="+fr+"&amount="+x+"&d="+Math.floor(Date.now()/(3.6*1e6));if(initialJSON.pass.length>0)url+="&pass="+initialJSON.pass;$lhttp.get(url,1400).then(function(data){Array.prototype.push.apply(vm.games,data.data);block=false}).catch(function(data,status){console.log(data,status);block=false})}};vm.rate=function(x,url){};vm.like=function(x){vm.rate(x,"like",1)};vm.dislike=function(x){vm.rate(x,"dislike",-1)};vm.ifDisabled=(()=>vm.disabled);vm.locChangeAlert="Please don't leave the page until the server has responded";if(vm.lang==="no")vm.locChangeAlert="Vennligst ikke forlat siden før serveren har svart";if(vm.lang==="es")vm.locChangeAlert="Por favor no salgas de la pagina hasta que el servidor responda";$rootScope.$on("$locationChangeStart",function(event){if(vm.disabled){event.preventDefault();alert(vm.locChangeAlert)}});$window.onbeforeunload=function(){if(vm.disabled)return locChangeAlert};vm.css="";vm.mlcLoaded=false;vm.lazyModulesLoaded=false;$rootScope.$on("$routeChangeSuccess",function(event){try{$window.ga("send","pageview",{page:$location.url()})}catch(e){}});$lhttp.get("min/lazy-js.min.js",2e3).then(function(data){eval(data);vm.lazyModulesLoaded=true});if(!/bot|curl|spider|google|twitter^$/i.test(navigator.userAgent)){$lhttp.get("src/js/scripts/analytics.js",0).then(data=>{eval(data)})}$lhttp.get("src/js/objects/"+vm.lang+"-text.json").then(data=>{vm.textData=data}).catch((data,status)=>{console.log(data,status);confirm("Unable to load textdata, do you want to reload the page?")?location.reload(true):null})}]);app.controller("categoryCtrl",["$http","$routeParams","$scope","urls","initialJSON","$lhttp",function($http,$routeParams,$scope,urls,initialJSON,$lhttp){let vm=this,block=false;vm.tag=$routeParams.category;vm.amount=1;vm.noGames=false;$scope.master.loc="Thorin-Games — "+vm.tag;vm.description={en:"Here you can find all our games with the tag "+vm.tag+" sorted by popularity",no:'Her kan du finne alle våre spill med taggen "'+vm.tag+'" sortert etter popularitet',es:'Aqui se encuentra todos nuestros juegos con la etiqueta "'+vm.tag+'" Ordenado por popularidad'};$scope.master.desc=vm.description[$scope.master.lang];vm.games=vm.tag in $scope.master.categoryGames?vm.games=$scope.master.categoryGames[vm.tag]:[];$lhttp.get(urls.countGames+"?tag="+vm.tag+"&d="+Date.now()+"&pass="+initialJSON.pass,800).then(function(data){vm.amount=Number(data);let str=$scope.master.desc;let query=" "+$scope.master.textData.games;$scope.master.desc=str.substring(0,str.indexOf(query))+" "+data+str.substring(str.indexOf(query));vm.amount>18?vm.requestGames(18):vm.requestGames(vm.amount);if(vm.amount==0)vm.noGames=true});vm.requestGames=function(x){if(!block&&!vm.allGamesAreDisplayed()){block=true;let from=vm.games.length,to=from+x;if(from+x>vm.amount)x=vm.amount-(from+x);let url=urls.getGames+"?from="+from+"&amount="+x+"&tag="+vm.tag+"&d="+Date.now()+"&pass="+initialJSON.pass;$lhttp.get(url,1500).then(function(data){Array.prototype.push.apply(vm.games,data.data);block=false;$scope.master.categoryGames[vm.tag]=vm.games})}};vm.allGamesAreDisplayed=(()=>{return vm.games.length>=vm.amount})}]);app.controller("gameCtrl",["$scope","$routeParams","$http","$sce","$interval","$timeout","$q","$window","$rootScope","$location","initialJSON","$lhttp","urls",function($scope,$routeParams,$http,$sce,$interval,$timeout,$q,$window,$rootScope,$location,initialJSON,$lhttp,urls){let vm=this;let block=false,disable=false,fails=0,canceler=$q.defer(),downloadTime;if(location.protocol=="https:")location.protocol="http:";let errorText=$scope.master.norsk?"Dette spillet kan ikke spilles her. Trykk her for å bli videresendt til riktig side":"This game can not be played here. Click here to be redirected";let url=urls.getGames+"?id="+$routeParams.id+"&pass="+initialJSON.pass;$lhttp.get(url,1500).then(function(data){$scope.detail=data;$scope.master.loc="Thorin-Games — "+data.title;$scope.master.desc=data.description;$scope.url=$sce.trustAsResourceUrl($scope.detail.file);if($scope.detail.height=="n")$scope.detail.height=.75*window.innerHeight;if($scope.detail.height=="r"||$scope.detail.width=="r"){let linkUl=document.createElement("ul");linkUl.setAttribute("class","nav nav-pills redirect");linkUl.innerHTML='<li style="float:none"><a style="color:#fbfbfb" href="'+$scope.url+'">'+text+"</a></li>";document.getElementById("wrapper").appendChild(linkUl)}else{$("embed").attr("src",$scope.url)}resizeEmbed();downloadTime=Date.now()});vm.rate=function(x,action){disable=true;block=true;let request=$http({method:"get",url:urls.rating+"?action="+action+"&id="+x});request.success(function(response){disable=false;block=false;$scope.detail.likes=response.data})};$scope.refresh=function(){disable=true,block=true;$http.get(urls.getGames+"?id="+$routeParams.id+"&pass="+initialJSON.pass+"&dt="+Date.now()).success(function(data){$scope.detail.comments=data.comments;downloadTime=Date.now();disable=false,block=false})};$scope.ifAnyChanges=function(){if(!block&&!disable){block=true;let url=urls.checkIfChanged+"?d="+Math.floor(Date.now()/1e4)+"&id="+$routeParams.id+"&coms="+$scope.detail.comments.length,start=Date.now();let request=$http({method:"get",url:url,timeout:canceler.promise});request.success(function(data){block=false,fails=0;if(JSON.parse(data))$scope.refresh();for(let i=0;i<$scope.detail.comments.length;i++){if(!$scope.detail.comments[i].date)$scope.detail.comments[i].date=1459870175813;$scope.detail.comments[i].date+=(Date.now()-start)/1e3}});request.error(function(data,status){block=false})}else if(fails>8){$scope.detail.comments=[{com:"Lost contact with server - trying to reconnect",author:"..."}];block=false;fails++}else{fails++}};let promise=$interval($scope.ifAnyChanges,2400);$scope.$on("$destroy",()=>$interval.cancel(promise));try{$scope.author=localStorage.username}catch(e){$scope.author=""}$scope.comment="";$scope.submit=(()=>{if(!disable&&$scope.comment.length>0&&$scope.author.length>0){$scope.commentForm.$setUntouched();try{localStorage.username=$scope.author}catch(e){}disable=true,block=true;$http.get(urls.comment+"?id="+$routeParams.id+"&com="+$scope.comment+"&author="+$scope.author).then(response=>{disable=false,block=false;$scope.detail.comments=response.data;$scope.comment="";$scope.refresh()}).catch(()=>{alert("Your message was not submitted.\nPlease try again.");block=false,disable=false})}else $scope.commentForm.$setTouched()});$scope.ifDisabled=(()=>disable);$rootScope.$on("$locationChangeStart",function(event){if(disable){event.preventDefault();alert($scope.master.locChangeAlert)}});$window.onbeforeunload=function(){if(disable)return locChangeAlert};$scope.goBack=function(){if($scope.master.routeChanged){$window.history.back(1)}else{$location.path("/")}};vm.scrollDown=function(){$("html, body").animate({scrollTop:$(document).height()},1e3)};vm.jquery=function(){var initialHeight=$("textarea").outerHeight();$("textarea").keyup(function(){var height=$("form.com-container>div").height()-24;$("a.glyphicon[type=submit]").css("line-height",height+"px");let maxChars=$("textarea").width()*(30/270);let newLines=Math.floor($("textarea").val().length/maxChars)+1;$("textarea").css("height",newLines*initialHeight+"px");if(!$scope.view.ifMobile)$("html, body").animate({scrollTop:$(document).height()})});$(window).resize(resizeEmbed)};function resizeEmbed(){if(/^[\d.,]+%$/.test($scope.detail.height)){initialJSON.jquery.then(function(){$("embed").ready(function(){$timeout(function(){$("embed").attr("height",$("embed").width()*(Number($scope.detail.height.split("%")[0])/100)+1)},1e3)})})}}initialJSON.jquery.then(vm.jquery);vm.ifSpace=(()=>window.innerWidth-document.querySelector("embed").clientWidth>140&&!$scope.view.ifMobile)}]);app.controller("viewCtrl",function(){var vm=this;vm.ifMobile="ontouchstart"in window;vm.ifATHd=function(){if(ios){if(!standalone&&safari){return false}else if(standalone&&!safari){return true}else if(!standalone&&!safari){return true}else{return false}}};vm.showHeader=function(){if(window.location.href.indexOf("/id/")>-1){return false}else{return true}}});app.directive("paraBack",["$window",function($window){return function(scope,element,attrs){element.css("background-image","url("+attrs.paraBack+")");element.css("background-attachment","fixed");var max=Infinity;var image=new Image;image.src=attrs.paraBack;image.onload=function(){max=image.height-window.innerHeight;var xOffset=-(image.width/2-element[0].offsetWidth/2);element.css("background-position-x",xOffset+"px")};var scrollHandler=function(){var offset=Math.floor(this.pageYOffset*.1);if(offset<max){element.css("background-position-y","-"+offset+"px")}};if(!scope.view.ifMobile){angular.element($window).on("scroll",scrollHandler);scope.$on("$destroy",function(){angular.element($window).off("scroll",scrollHandler)})}}}]);
=======
var app=angular.module("app",["ngRoute"]);
app.config(["$routeProvider","$sceProvider","$locationProvider","$controllerProvider","$provide","$compileProvider","$filterProvider","$sceDelegateProvider",function(a,f,d,g,e,h,b,m){m.resourceUrlWhitelist(["self","https://script.google.com"]);a.when("/",{templateUrl:"src/views/home.html"}).when("/tag/:category",{templateUrl:"src/views/category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/search/:category",{templateUrl:"src/views/category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/id/:id",
{controller:"gameCtrl",controllerAs:"g",templateUrl:"src/views/game.html"}).when("/submit",{templateUrl:"src/views/submit.html"}).when("/cookies",{templateUrl:"src/views/policy.html"}).when("/contact",{templateUrl:"src/views/contact.html"}).when("/game/:id",{redirectTo:"/id/:id"}).when("/tag",{redirectTo:"/"}).when("/403",{templateUrl:"src/views/error.html"}).when("/401",{templateUrl:"src/views/error.html"}).otherwise({templateUrl:"src/views/error.html"});f.enabled(!0);d.html5Mode(!0);app.controller=
function(a,b){g.register(a,b);return this};app.service=function(a,b){e.service(a,b);return this};app.factory=function(a,b){e.factory(a,b);return this};app.value=function(a,b){e.value(a,b);return this};app.directive=function(a,b){h.directive(a,b);return this};app.filter=function(a,d){b.register(a,d);return this}}]);
app.service("initialJSON",["$http","$lhttp","urls",function(a,f,d){this.pass=encodeURIComponent(window.location.search.slice(1)+window.location.hash.slice(1));this.json=f.get(d.initialJSON+"?pass="+this.pass);this.jquery=f.get("https://code.jquery.com/jquery-2.2.3.min.js",0);this.jquery.then(function(a){eval(a)})}]);app.directive("script",function(){return{restrict:"E",scope:!1,link:function(a,f,d){"text/javascript-lazy"===d.type&&eval(f[0].text)}}});
app.value("urls",{rating:"https://script.google.com/macros/s/AKfycbzulzGAeSR2eErndxSAUkDi3dXlnmYif0MlkpjnfJsHKVNSMpE/exec",checkIfChanged:"https://script.google.com/macros/s/AKfycbwx-oLuzjUIAPxMxKiiNFgt6Wgb6T4WGO8UguTGu8HCXUBt-SX7/exec",comment:"https://script.google.com/macros/s/AKfycbwK2mif23UU5f9B2NXuvcRT6VajMU7iXQPxRnlKeNtfsD2Eflvz/exec",countGames:"https://script.google.com/macros/s/AKfycbwc3i7zLH3vC8HWnVtBVPqZkv8iOMIlxKZ1E7gL2bdIL8kd9lA/exec",getGames:"https://script.google.com/macros/s/AKfycbxGh5agyHkqBi5KbpYxl9G2gJlR5kuJzjJ--5BaP-KfcgaItx0/exec",
submitGame:"https://script.google.com/macros/s/AKfycbxh_WPU_DKwT3xAxR0BCcjb_wQ4pQG2nspBbpKra94BEYlO4yw/exec",subscribe:"",initialJSON:"/min/initialJSON.json"});
app.service("$lhttp",["$http","$q","$timeout",function(a,f,d){var g=this;g.ldbOn=!0;try{!function(){function a(d,q){return b?void(b.transaction("s").objectStore("s").get(d).onsuccess=function(a){q(a.target.result&&a.target.result.v||null)}):void setTimeout(function(){a(d,q)},100)}var d=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!d)return void console.error("indexDB not supported");var b,f={k:"",v:""},d=d.open("d2",1);d.onsuccess=function(a){b=this.result};
d.onerror=function(a){console.error("indexedDB request error");console.log(a)};d.onupgradeneeded=function(a){b=null;a.target.result.createObjectStore("s",{keyPath:"k"}).transaction.oncomplete=function(a){b=a.target.db}};window.ldb={get:a,set:function(a,d){f.k=a;f.v=d;b.transaction("s","readwrite").objectStore("s").put(f)}}}()}catch(e){console.warn("Unable to use lbd, using localStorage instead. Error:",e),g.ldbOn=!1}g.get=function(e,h,b,m){var k=f.defer();"undefined"===typeof b&&(b={});b.timeout=
k.promise;b=a.get(e,b);b.success(function(a){try{g.ldbOn?ldb.set(e,JSON.stringify(a)):localStorage[e]=JSON.stringify(a)}catch(p){console.log("Couldn't save "+e+"-data to storage. Error:",p)}k.resolve(a)});b.error(function(a,b){try{ldb.get(e,function(a){null!==a?k.resolve(JSON.parse(a)):"undefined"!==typeof localStorage[e]?k.resolve(JSON.parse(localStorage[e])):k.reject("ERROR")})}catch(t){try{"undefined"!==typeof localStorage[e]?k.resolve(JSON.parse(localStorage[e])):k.reject("ERROR")}catch(c){k.reject("ERROR")}}});
"undefined"!==typeof h&&d(function(){g.ldbOn?ldb.get(e,function(a){null!==a?k.resolve(JSON.parse(a)):""}):"undefined"!==typeof Storage&&e in localStorage&&k.resolve(JSON.parse(localStorage[e]))},h);"undefined"!==typeof m&&m["catch"](function(){k.reject("Canceled")});return k.promise}}]);app.controller("masterCtrl",["$http","$window","$rootScope","$routeParams","$scope","$location","$timeout","$injector","$q","initialJSON","$lhttp","urls",function(a,f,d,g,e,h,b,m,k,q,p,t){var c=this,r=c.disabled=!1;c.lang=window.navigator.language.replace(/-.+/g,"");c.availableLangs=[];c.desc="";c.games=[];c.categoryGames={};c.routeChanged=!1;c.verifiedUser=!1;c.otag="";c.tags=[{name:"Puzzle",amount:470},{name:"Action",amount:334},{name:"Jigsaw Puzzles",amount:315},{name:"Shooting",amount:256},{name:"HTML5",
amount:210},{name:"Racing",amount:202},{name:"Adventure",amount:196}];c.x=18;c.textData={};c.tagLimit=8;c.showAllTags=!1;c.availableLangs=["en","es","no"];window.location.href.includes("lang=")&&(c.lang=window.location.href.replace(/.+lang=/,""));c.lang="nb"==c.lang||"nn"==c.lang?"no":c.lang;c.lang=-1<c.availableLangs.indexOf(c.lang)?c.lang:"en";c.allGamesAreDisplayed=function(){return c.games.length<c.x?!1:!0};q.json.then(function(a){Array.prototype.push.apply(c.games,a.initialGames);c.verifiedUser=
a.verifiedUser;c.tags=a.topTags;c.x=a.count});c.requestGames=function(a){r||c.allGamesAreDisplayed()||(r=!0,a=t.getGames+"?from="+c.games.length+"&amount="+a+"&d="+Math.floor(Date.now()/36E5),0<q.pass.length&&(a+="&pass="+q.pass),p.get(a,1400).then(function(a){Array.prototype.push.apply(c.games,a.data);r=!1})["catch"](function(a,b){console.log(a,b);r=!1}))};c.rate=function(a,b){};c.like=function(a){c.rate(a,"like",1)};c.dislike=function(a){c.rate(a,"dislike",-1)};c.ifDisabled=function(){return c.disabled};
c.locChangeAlert="Please don't leave the page until the server has responded";"no"===c.lang&&(c.locChangeAlert="Vennligst ikke forlat siden f\u00f8r serveren har svart");"es"===c.lang&&(c.locChangeAlert="Por favor no salgas de la pagina hasta que el servidor responda");d.$on("$locationChangeStart",function(a){c.disabled&&(a.preventDefault(),alert(c.locChangeAlert))});f.onbeforeunload=function(){if(c.disabled)return locChangeAlert};c.css="";c.mlcLoaded=!1;c.lazyModulesLoaded=!1;d.$on("$routeChangeSuccess",
function(a){try{f.ga("send","pageview",{page:h.url()})}catch(l){}});p.get("min/lazy-js.min.js",2E3).then(function(a){eval(a);c.lazyModulesLoaded=!0});/bot|curl|spider|google|twitter^$/i.test(navigator.userAgent)||p.get("src/js/scripts/analytics.js",0).then(function(a){eval(a)});p.get("src/js/objects/"+c.lang+"-text.json").then(function(a){c.textData=a})["catch"](function(a,b){console.log(a,b);confirm("Unable to load textdata, do you want to reload the page?")?location.reload(!0):null})}]);app.controller("categoryCtrl",["$http","$routeParams","$scope","urls","initialJSON","$lhttp",function(a,f,d,g,e,h){var b=this,m=!1;b.tag=f.category;b.amount=1;b.noGames=!1;d.master.loc="Thorin-Games \u2014 "+b.tag;b.description={en:"Here you can find all our games with the tag "+b.tag+" sorted by popularity",no:'Her kan du finne alle v\u00e5re spill med taggen "'+b.tag+'" sortert etter popularitet',es:'Aqui se encuentra todos nuestros juegos con la etiqueta "'+b.tag+'" Ordenado por popularidad'};
d.master.desc=b.description[d.master.lang];b.games=b.tag in d.master.categoryGames?b.games=d.master.categoryGames[b.tag]:[];h.get(g.countGames+"?tag="+b.tag+"&d="+Date.now()+"&pass="+e.pass,800).then(function(a){b.amount=Number(a);var e=d.master.desc,f=" "+d.master.textData.games;d.master.desc=e.substring(0,e.indexOf(f))+" "+a+e.substring(e.indexOf(f));18<b.amount?b.requestGames(18):b.requestGames(b.amount);0==b.amount&&(b.noGames=!0)});b.requestGames=function(a){if(!m&&!b.allGamesAreDisplayed()){m=
!0;var f=b.games.length;f+a>b.amount&&(a=b.amount-(f+a));a=g.getGames+"?from="+f+"&amount="+a+"&tag="+b.tag+"&d="+Date.now()+"&pass="+e.pass;h.get(a,1500).then(function(a){Array.prototype.push.apply(b.games,a.data);m=!1;d.master.categoryGames[b.tag]=b.games})}};b.allGamesAreDisplayed=function(){return b.games.length>=b.amount}}]);app.controller("gameCtrl",["$scope","$routeParams","$http","$sce","$interval","$timeout","$q","$window","$rootScope","$location","initialJSON","$lhttp","urls",function(a,f,d,g,e,h,b,m,k,q,p,t,c){function r(){/^[\d.,]+%$/.test(a.detail.height)&&p.jquery.then(function(){$("embed").ready(function(){h(function(){$("embed").attr("height",$("embed").width()*(Number(a.detail.height.split("%")[0])/100)+1)},1E3)})})}var n=!1,l=!1,u=0,v=b.defer();"https:"==location.protocol&&(location.protocol="http:");t.get(c.getGames+
"?id="+f.id+"&pass="+p.pass,1500).then(function(b){a.detail=b;a.master.loc="Thorin-Games \u2014 "+b.title;a.master.desc=b.description;a.url=g.trustAsResourceUrl(a.detail.file);"n"==a.detail.height&&(a.detail.height=.75*window.innerHeight);"r"==a.detail.height||"r"==a.detail.width?(b=document.createElement("ul"),b.setAttribute("class","nav nav-pills redirect"),b.innerHTML='<li style="float:none"><a style="color:#fbfbfb" href="'+a.url+'">'+text+"</a></li>",document.getElementById("wrapper").appendChild(b)):
$("embed").attr("src",a.url);r();Date.now()});this.rate=function(b,e){n=l=!0;d({method:"get",url:c.rating+"?action="+e+"&id="+b}).success(function(b){n=l=!1;a.detail.likes=b.data})};a.refresh=function(){n=l=!0;d.get(c.getGames+"?id="+f.id+"&pass="+p.pass+"&dt="+Date.now()).success(function(b){a.detail.comments=b.comments;Date.now();n=l=!1})};a.ifAnyChanges=function(){if(n||l)8<u&&(a.detail.comments=[{com:"Lost contact with server - trying to reconnect",author:"..."}],n=!1),u++;else{n=!0;var b=c.checkIfChanged+
"?d="+Math.floor(Date.now()/1E4)+"&id="+f.id+"&coms="+a.detail.comments.length,e=Date.now(),b=d({method:"get",url:b,timeout:v.promise});b.success(function(b){n=!1;u=0;JSON.parse(b)&&a.refresh();for(b=0;b<a.detail.comments.length;b++)a.detail.comments[b].date||(a.detail.comments[b].date=1459870175813),a.detail.comments[b].date+=(Date.now()-e)/1E3});b.error(function(a,b){n=!1})}};var x=e(a.ifAnyChanges,2400);a.$on("$destroy",function(){return e.cancel(x)});try{a.author=localStorage.username}catch(w){a.author=
""}a.comment="";a.submit=function(){if(!l&&0<a.comment.length&&0<a.author.length){a.commentForm.$setUntouched();try{localStorage.username=a.author}catch(w){}n=l=!0;d.get(c.comment+"?id="+f.id+"&com="+a.comment+"&author="+a.author).then(function(b){n=l=!1;a.detail.comments=b.data;a.comment="";a.refresh()})["catch"](function(){alert("Your message was not submitted.\nPlease try again.");l=n=!1})}else a.commentForm.$setTouched()};a.ifDisabled=function(){return l};k.$on("$locationChangeStart",function(b){l&&
(b.preventDefault(),alert(a.master.locChangeAlert))});m.onbeforeunload=function(){if(l)return locChangeAlert};a.goBack=function(){a.master.routeChanged?m.history.back(1):q.path("/")};this.scrollDown=function(){$("html, body").animate({scrollTop:$(document).height()},1E3)};this.jquery=function(){var b=$("textarea").outerHeight();$("textarea").keyup(function(){var c=$("form.com-container>div").height()-24;$("a.glyphicon[type=submit]").css("line-height",c+"px");c=$("textarea").width()*(30/270);c=Math.floor($("textarea").val().length/
c)+1;$("textarea").css("height",c*b+"px");a.view.ifMobile||$("html, body").animate({scrollTop:$(document).height()})});$(window).resize(r)};p.jquery.then(this.jquery);this.ifSpace=function(){return 140<window.innerWidth-document.querySelector("embed").clientWidth&&!a.view.ifMobile}}]);app.controller("viewCtrl",function(){this.ifMobile="ontouchstart"in window;this.ifATHd=function(){if(ios)return!standalone&&safari?!1:standalone&&!safari?!0:standalone||safari?!1:!0};this.showHeader=function(){return-1<window.location.href.indexOf("/id/")?!1:!0}});app.directive("paraBack",["$window",function(a){return function(f,d,g){d.css("background-image","url("+g.paraBack+")");d.css("background-attachment","fixed");var e=Infinity,h=new Image;h.src=g.paraBack;h.onload=function(){e=h.height-window.innerHeight;d.css("background-position-x",-(h.width/2-d[0].offsetWidth/2)+"px")};var b=function(){var a=Math.floor(.1*this.pageYOffset);a<e&&d.css("background-position-y","-"+a+"px")};f.view.ifMobile||(angular.element(a).on("scroll",b),f.$on("$destroy",function(){angular.element(a).off("scroll",
b)}))}}]);
>>>>>>> c546852449ef54e5b756c1cee8bde93674b05e5f
